// Code generated by Wire. DO NOT EDIT.

//go:generate go run github.com/google/wire/cmd/wire
//go:build !wireinject
// +build !wireinject

package main

import (
	"github.com/ethereum/go-ethereum/ethclient"
	"gitlab.com/TitanInd/hashrouter/api"
	"gitlab.com/TitanInd/hashrouter/app"
	"gitlab.com/TitanInd/hashrouter/config"
	"gitlab.com/TitanInd/hashrouter/connections"
	"gitlab.com/TitanInd/hashrouter/contractmanager"
	"gitlab.com/TitanInd/hashrouter/events"
	"gitlab.com/TitanInd/hashrouter/interfaces"
	"gitlab.com/TitanInd/hashrouter/lib"
	"go.uber.org/zap"
	"os"
)

// Injectors from main.go:

func InitApp() (*app.App, error) {
	config, err := provideConfig()
	if err != nil {
		return nil, err
	}
	iEventManager := events.NewEventManager()
	sugaredLogger, err := provideLogger(config)
	if err != nil {
		return nil, err
	}
	connectionsController := provideConnectionController(config, iEventManager, sugaredLogger)
	server := provideServer(config, connectionsController, sugaredLogger)
	client, err := provideEthClient(config)
	if err != nil {
		return nil, err
	}
	sellerContractManager := provideSellerContractManager(config, iEventManager, client, sugaredLogger)
	appApp := &app.App{
		ConnectionsController: connectionsController,
		Server:                server,
		SellerManager:         sellerContractManager,
		Logger:                sugaredLogger,
	}
	return appApp, nil
}

// main.go:

const VERSION = "0.01"

func main() {
	appInstance, err := InitApp()
	if err != nil {
		panic(err)
	}

	appInstance.Run()
}

func provideConnectionController(cfg *config.Config, em interfaces.IEventManager, l *zap.SugaredLogger) *connections.ConnectionsController {
	return connections.NewConnectionsController(cfg.Pool.Address, cfg.Pool.User, cfg.Pool.Password, em, l)
}

func provideServer(cfg *config.Config, cc *connections.ConnectionsController, l *zap.SugaredLogger) *api.Server {
	return api.NewServer(cfg.Web.Address, cc, l)
}

func provideEthClient(cfg *config.Config) (*ethclient.Client, error) {
	return contractmanager.NewEthClient(cfg.EthNode.Address)
}

func provideSellerContractManager(cfg *config.Config, em interfaces.IEventManager, ethClient *ethclient.Client, logger *zap.SugaredLogger) *contractmanager.SellerContractManager {
	return contractmanager.NewSellerContractManager(logger, em, ethClient, cfg.Contract.Address)
}

func provideLogger(cfg *config.Config) (*zap.SugaredLogger, error) {
	return lib.NewLogger(cfg.Log.Syslog)
}

func provideConfig() (*config.Config, error) {
	var cfg config.Config
	return &cfg, config.LoadConfig(&cfg, &os.Args)
}
